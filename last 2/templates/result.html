<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Attendance Result</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
  * {
    margin: 0; padding: 0; box-sizing: border-box;
    font-family: 'Roboto', sans-serif;
  }
  body {
    min-height: 100vh;
    color: #333;

    /* Background: gradient overlay plus background image */
    background:
      linear-gradient(rgba(244, 246, 249, 0.9), rgba(244, 246, 249, 0.9)),
      url('https://media.istockphoto.com/id/2224775599/photo/empty-university-classrooms-in-iran.jpg?s=612x612&w=0&k=20&c=BU-7OmVBQuXvnfxa_qWRuLsSSDVKLOTZ9qggNSW0xgA=') no-repeat center center fixed;
    background-size: cover;
    background-attachment: fixed;
  }

  /* Navbar */
  .navbar {
    background: #242222ff !important;
    color: #fff;
  }
  .navbar-brand,
  .navbar-nav .nav-link {
    color: #fff !important;
    font-weight: 600;
  }
  .navbar-nav .nav-link:hover,
  .navbar-nav .nav-link:focus {
    text-decoration: underline;
    outline-offset: 2px;
  }

  h2 {
    text-align: center;
    margin: 20px 15px 30px;
    color: #000000ff;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.05em;
  }

  /* Summary Bar */
  .summary-bar {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 30px;
    flex-wrap: wrap;
    padding: 0 10px;
  }
  .summary-card {
    flex: 1 1 180px;
    max-width: 280px;
    padding: 18px 28px;
    border-radius: 14px;
    text-align: center;
    color: white;
    font-weight: 700;
    font-size: 20px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.12);
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }
  .summary-card svg {
    width: 28px;
    height: 28px;
    flex-shrink: 0;
  }
  .present-summary {
    background: #4caf50;
  }
  .absent-summary {
    background: #f44336;
  }

  /* Form and Table */
  form {
    max-width: 960px;
    margin: auto;
    background: #fff;
    padding: 30px 25px;
    border-radius: 14px;
    box-shadow: 0 10px 26px rgba(0,0,0,0.1);
    animation: fadeIn 0.6s ease both;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .table-responsive {
    overflow-x: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 480px;
  }
  th, td {
    padding: 15px 18px;
    text-align: center;
    vertical-align: middle;
  }
  th {
    background: #2e7d32;
    color: #fff;
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: 0.05em;
  }
  tbody tr {
    transition: background-color 0.4s ease;
    user-select: none;
  }
  tbody tr:hover {
    background: #f3faef;
  }

  /* Toggle Buttons */
  .status-toggle {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: nowrap;
  }
  .status-toggle label {
    cursor: pointer;
    user-select: none;
    font-weight: 600;
    position: relative;
    font-size: 1rem;
  }
  /* Hide radios */
  .status-toggle input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }
  /* Styled spans */
  .status-toggle span {
    display: inline-block;
    padding: 10px 22px;
    border-radius: 26px;
    border: 2px solid #bbb;
    transition: all 0.3s ease;
    line-height: 1.1;
  }
  .status-toggle span:hover,
  .status-toggle span:focus-visible {
    border-color: #555;
    outline: none;
  }
  /* Checked styles */
  .status-toggle input[value="Present"]:checked + span {
    background: #4caf50;
    color: #fff;
    box-shadow: 0 0 12px #4caf50aa;
    border-color: #4caf50;
  }
  .status-toggle input[value="Absent"]:checked + span {
    background: #f44336;
    color: #fff;
    box-shadow: 0 0 12px #f44336aa;
    border-color: #f44336;
  }

  /* Row Highlights */
  .present-row {
    background: #e8f5e9 !important;
  }
  .absent-row {
    background: #ffebee !important;
  }

  /* Submit Button */
  button[type="submit"] {
    display: block;
    width: 100%;
    padding: 14px;
    font-size: 1.2rem;
    font-weight: 700;
    color: white;
    background: linear-gradient(45deg, #2e7d32, #4caf50);
    border: none;
    border-radius: 10px;
    margin-top: 30px;
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  button[type="submit"]:hover,
  button[type="submit"]:focus-visible {
    transform: scale(1.06);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    outline-offset: 4px;
    outline: 2px solid #4caf50;
  }

  /* Responsive */
  @media (max-width: 650px) {
    h2 {
      font-size: 1.6rem;
      margin: 15px 10px 25px;
    }
    .summary-card {
      flex: 1 1 140px;
      font-size: 1.1rem;
      padding: 14px 18px;
    }
    .status-toggle span {
      padding: 7px 14px;
      font-size: 0.9rem;
    }
    th, td {
      padding: 12px 10px;
      font-size: 0.95rem;
    }
  }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark" role="navigation" aria-label="Primary navigation">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('index') }}">AI Attendance</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('students') }}">Students</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('take_attendance') }}">Take Attendance</a></li>
      </ul>
    </div>
  </div>
</nav>

<h2 tabindex="0">Attendance for {{ today }}</h2>

<!-- Summary Bar -->
<div class="summary-bar" aria-live="polite" aria-atomic="true">
  <div class="summary-card present-summary" aria-label="Total present students">
    <svg fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zm6 2H6c-1.1 0-2 .9-2 2v2h16v-2c0-1.1-.9-2-2-2z"/></svg>
    Present: <span id="present-count">{{ present_count }}</span>
  </div>
  <div class="summary-card absent-summary" aria-label="Total absent students">
    <svg fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M16.24 7.76a.996.996 0 10-1.41-1.41L12 9.17 9.17 6.34a.996.996 0 10-1.41 1.41L10.59 12l-2.83 2.83a.996.996 0 101.41 1.41L12 14.83l2.83 2.83a.996.996 0 101.41-1.41L13.41 12l2.83-2.83z"/></svg>
    Absent: <span id="absent-count">{{ absent_count }}</span>
  </div>
</div>

<form action="{{ url_for('save_attendance') }}" method="POST" role="form" aria-label="Attendance modification form">
  <div class="table-responsive">
    <table role="grid" aria-describedby="present-count absent-count">
      <thead>
        <tr>
          <th scope="col">Student</th>
          <th scope="col">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for student, status in attendance.items() %}
        <tr class="{% if status == 'Absent' %}absent-row{% elif status == 'Present' %}present-row{% endif %}">
          <td>{{ student.title() }}</td>
          <td>
            <div class="status-toggle" role="radiogroup" aria-label="Attendance status for {{ student.title() }}">
              <label>
                <input type="radio" name="{{ student }}" value="Present" {% if status=='Present' %}checked{% endif %}>
                <span tabindex="0">Present</span>
              </label>
              <label>
                <input type="radio" name="{{ student }}" value="Absent" {% if status=='Absent' %}checked{% endif %}>
                <span tabindex="0">Absent</span>
              </label>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <button type="submit" aria-label="Save final attendance">ðŸ’¾ Save Final Attendance</button>
</form>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function updateSummary() {
    const rows = document.querySelectorAll("tbody tr");
    let present = 0, absent = 0;
    rows.forEach(row => {
      const presentInput = row.querySelector('input[value="Present"]');
      if (presentInput && presentInput.checked) present++;
      else absent++;
    });
    document.getElementById("present-count").textContent = present;
    document.getElementById("absent-count").textContent = absent;
  }

  document.querySelectorAll('input[type=radio]').forEach(input => {
    input.addEventListener('change', function() {
      const row = this.closest("tr");
      if (this.value === "Absent") {
        row.classList.add("absent-row");
        row.classList.remove("present-row");
      } else {
        row.classList.add("present-row");
        row.classList.remove("absent-row");
      }
      updateSummary();
    });
  });

  // Initialize summary on page load
  updateSummary();
</script>

</body>
</html>

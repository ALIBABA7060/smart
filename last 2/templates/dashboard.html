<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
body {
    font-family: 'Roboto', sans-serif;
    color: #fff;
    min-height: 100vh;
    background:
      linear-gradient(135deg, rgba(0,0,0,0.65), rgba(0,0,0,0.65)),
      url('https://images.unsplash.com/photo-1629528026812-046ce5f40936?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTZ8fHNjaG9vbCUyMGJ1aWxkaW5nfGVufDB8fDB8fHww') no-repeat center center fixed;
    background-size: cover;
}
.navbar { background: rgba(0,0,0,0.6) !important; }
.navbar-brand { font-weight: 700; font-size: 1.9rem; letter-spacing: 0.05em; }
.card {
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover { transform: translateY(-10px); box-shadow: 0 18px 40px rgba(0,0,0,0.6); }
.display-5 { font-weight: 800; font-size: 3rem; }
.card h4 { margin-top: 1rem; font-weight: 600; }
.alert-custom {
    background: rgba(255,0,0,0.5);
    color: #fff;
    padding: 1rem 1.2rem;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
    margin-top: 1.5rem;
}
.row.g-4 { margin-top: 2rem; }
.btn-dashboard {
    font-weight: 700;
    text-transform: uppercase;
    border-radius: 12px;
    transition: transform 0.2s, box-shadow 0.2s;
}
.btn-dashboard:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
}
.card i {
    font-size: 4rem;
    margin-bottom: 0.5rem;
    transition: transform 0.3s, color 0.3s;
}
.card:hover i { transform: scale(1.2); color: #fff; }
@media (max-width: 768px) {
    .display-5 { font-size: 2.2rem; }
    .card i { font-size: 3rem; }
}
.toast-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 1055;
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark px-4">
    <a class="navbar-brand" href="{{ url_for('index') }}">AI Attendance</a>
    <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
            <li class="nav-item"><a class="nav-link active" href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('students') }}">Students</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('take_attendance') }}">Take Attendance</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
        </ul>
    </div>
</nav>

<div class="container my-5">
    <h2 class="text-center mb-4">Teacher Dashboard</h2>
    <div class="row g-4 text-dark">
        <div class="col-md-4 col-sm-6">
            <div class="card bg-primary text-white">
                <i class="bi bi-people-fill"></i>
                <h4>Total Students</h4>
                <p class="display-5" data-target="{{ total_students }}">0</p>
            </div>
        </div>
        <div class="col-md-4 col-sm-6">
            <div class="card bg-success text-white">
                <i class="bi bi-check-circle-fill"></i>
                <h4>Present Today</h4>
                <p class="display-5" data-target="{{ present_count }}">0</p>
            </div>
        </div>
        <div class="col-md-4 col-sm-6">
            <div class="card bg-danger text-white">
                <i class="bi bi-x-circle-fill"></i>
                <h4>Absent Today</h4>
                <p class="display-5" data-target="{{ absent_count }}">0</p>
            </div>
        </div>
    </div>

    {% if sms_sent %}
    <div class="alert-custom mt-4">
        Parents notified for absent students: {{ sms_sent | join(', ') }}
    </div>
    {% endif %}

    <div class="row g-4 mt-5">
        <div class="col-md-3 col-sm-6">
            <a href="{{ url_for('take_attendance') }}" class="btn btn-primary w-100 btn-dashboard">Take Attendance</a>
        </div>
        <div class="col-md-3 col-sm-6">
            <a href="{{ url_for('students') }}" class="btn btn-info w-100 btn-dashboard text-white">Student Details</a>
        </div>
        <div class="col-md-3 col-sm-6">
            <a href="{{ url_for('download', filename='attendance_' ~ now.strftime('%Y-%m-%d') ~ '.csv') }}" class="btn btn-success w-100 btn-dashboard">Download CSV</a>
        </div>
        <div class="col-md-3 col-sm-6">
            <a href="{{ url_for('index') }}" class="btn btn-secondary w-100 btn-dashboard">Home</a>
        </div>
    </div>
</div>

<!-- Toast Notifications -->
<div class="toast-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="toast align-items-center text-bg-{{ category }} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
              <div class="toast-body">{{ message }}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Animate counters
const counters = document.querySelectorAll('.display-5');
counters.forEach(counter => {
    const updateCount = () => {
        const target = +counter.getAttribute('data-target');
        const count = +counter.innerText;
        const increment = Math.ceil(target / 100);
        if(count < target) {
            counter.innerText = count + increment;
            setTimeout(updateCount, 20);
        } else {
            counter.innerText = target;
        }
    };
    updateCount();
});

// Show toast messages
document.addEventListener('DOMContentLoaded', () => {
    const toastElList = [].slice.call(document.querySelectorAll('.toast'))
    toastElList.forEach(toastEl => {
        const toast = new bootstrap.Toast(toastEl, { delay: 5000 })
        toast.show()
    });
});
</script>

</body>
</html>
